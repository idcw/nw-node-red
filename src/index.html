<html>
<script>
    const pkg = require('./package.json');
    const appName = pkg["name"];
    let options;
    console.log(options);
    if (pkg.hasOwnProperty("NRnwjs")) { options = pkg["NRnwjs"] }

    const urldash = "/ui/#/0";          // url for the dashboard page
    const urledit = "/red";             // url for the editor page
    const urlconsole = "/console.htm";  // url for the console page
    const listenPort = options.port || 18880;

    location.href = "http://localhost:" + listenPort + urledit;

    let menu = new nw.Menu({type: 'menubar'});
    if(process.platform === 'darwin'){
        menu.createMacBuiltin(appName,{
            hideEdit: true,
            hideWindow: false
        });
    }

    const template = [{
        label: "View",
        submenu: [
            {   label: 'Import Flow',
                key: "O",
                modifiers: "shift+alt",
                click: function(){
                    //  openFlow(); 
                }
            },
            {   label: 'Save Flow As',
                key: "S",
                modifiers: "shift+alt"                
                // click: function() { saveFlow(); }
            },
            {   type: 'separator' },
            {   
                label: 'Console',
                key: "C",
                modifiers: "shift+alt"
                // click: function() { createConsole(); }
            },
            {   label: 'Dashboard',
                key: "D",
                modifiers: "shift+alt",                
                click: function(){ nw.Window.open("http://localhost:"+listenPort+urldash); }
            },
            {   label: 'Editor',
                key: "E",
                modifiers: "shift+alt",
                click: function(){ nw.Window.open("http://localhost:"+listenPort+urledit); }
            },
            {   type: 'separator' },
            {   type: 'separator' },
            {   label: 'Documentation',
                click: function(){ nw.shell.openExternal('https://nodered.org/docs') }
            },
            {   label: 'Flows and Nodes',
                click: function(){ nw.shell.openExternal('https://flows.nodered.org') }
            },
            {   label: 'Discourse Forum',
                click: function(){ nw.shell.openExternal('https://discourse.nodered.org/') }
            }
        ]
    }];

    var submenu = new nw.Menu();
    for(const sm of template[0].submenu){
        console.log(sm);
        submenu.append(new nw.MenuItem(sm));
    }
    
    menu.append(new nw.MenuItem({
        label: template[0].label,
        submenu: submenu
    }));
    nw.Window.get().menu = menu;
</script>

</html>